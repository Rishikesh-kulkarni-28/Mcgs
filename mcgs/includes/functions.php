<?php function e($str) { return htmlspecialchars((string)$str, ENT_QUOTES, 'UTF-8'); } function post($key, $default='') { return isset($_POST[$key]) ? trim($_POST[$key]) : $default; } function getv($key, $default='') { return isset($_GET[$key]) ? trim($_GET[$key]) : $default; } function randomRefNumber(PDO $dbh) { do { $ref = random_int(100000000, 999999999); $st = $dbh->prepare('SELECT 1 FROM tblmedicalcard WHERE RefNumber=? LIMIT 1'); $st->execute([$ref]); $exists = $st->fetch(); } while ($exists); return $ref; } function validImageUpload($file) { if (empty($file['name']) || $file['error'] !== UPLOAD_ERR_OK) return [false, 'No file uploaded or upload error']; if ($file['size'] > 2*1024*1024) return [false, 'Max 2MB allowed']; $finfo = finfo_open(FILEINFO_MIME_TYPE); $mime = finfo_file($finfo, $file['tmp_name']); finfo_close($finfo); $allowed = ['image/jpeg'=>'jpg','image/png'=>'png']; if (!isset($allowed[$mime])) return [false, 'Only JPG/PNG allowed']; $ext = $allowed[$mime]; $name = bin2hex(random_bytes(8)).".".$ext; return [true, $name]; }