<?php require_once __DIR__.'/../includes/dbconnection.php'; require_once __DIR__.'/../includes/functions.php'; require_once __DIR__.'/header.php'; $msg=''; if ($_SERVER['REQUEST_METHOD']==='POST') { $ref = randomRefNumber($dbh); $name = post('FullName'); $phone = post('ContactNumber'); $email = post('Email'); $bg = post('BloodGroup'); $age = (int)post('Age'); $gender = post('Gender'); $address = post('Address'); $cond = post('MedicalCond'); $issued = post('IssuedDate'); $valid = post('ValidDate'); $imageName = null; if (!empty($_FILES['ProfileImage']['name'])) { [$ok, $res] = validImageUpload($_FILES['ProfileImage']); if ($ok) { $imageName = $res; move_uploaded_file($_FILES['ProfileImage']['tmp_name'], __DIR__."/../uploads/".$imageName); } else { $msg = $res; } } if (!$msg) { $st = $dbh->prepare("INSERT INTO tblmedicalcard (RefNumber,FullName,ProfileImage,ContactNumber,Email,BloodGroup,Age,Gender,Address,MedicalCond,IssuedDate,ValidDate) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)"); $st->execute([$ref,$name,$imageName,$phone,$email,$bg,$age,$gender,$address,$cond,$issued,$valid]); $msg = "Medical card created with RefNumber: $ref"; } } ?> <h3>Add Medical Card</h3> <?php if($msg): ?><div class="alert alert-info"><?php echo e($msg); ?></div><?php endif; ?> <form method="post" enctype="multipart/form-data" class="row g-3"> <div class="col-md-6"><label class="form-label">Full Name</label><input name="FullName" class="form-control" required></div> <div class="col-md-6"><label class="form-label">Profile Image (JPG/PNG, max 2MB)</label><input type="file" name="ProfileImage" class="form-control"></div> <div class="col-md-4"><label class="form-label">Contact Number</label><input name="ContactNumber" class="form-control" required></div> <div class="col-md-4"><label class="form-label">Email</label><input name="Email" type="email" class="form-control"></div> <div class="col-md-4"><label class="form-label">Blood Group</label><input name="BloodGroup" class="form-control"></div> <div class="col-md-3"><label class="form-label">Age</label><input name="Age" type="number" class="form-control"></div> <div class="col-md-3"><label class="form-label">Gender</label> <select name="Gender" class="form-select"> <option>Male</option><option>Female</option><option>Other</option> </select> </div> <div class="col-md-6"><label class="form-label">Issued Date</label><input name="IssuedDate" class="form-control" placeholder="YYYY-MM-DD"></div> <div class="col-md-6"><label class="form-label">Valid Date</label><input name="ValidDate" class="form-control" placeholder="YYYY-MM-DD"></div> <div class="col-12"><label class="form-label">Address</label><textarea name="Address" class="form-control" rows="2"></textarea></div> <div class="col-12"><label class="form-label">Medical Conditions</label><textarea name="MedicalCond" class="form-control" rows="3"></textarea></div> <div class="col-12"><button class="btn btn-primary">Create Card</button></div> </form> <?php require_once __DIR__.'/footer.php'; ?>