<?php declare(strict_types=1); session_start(); if (empty($_SESSION['admin_id'])) { header('Location: login.php'); exit; } require_once __DIR__ . '/../includes/dbconnection.php'; $id = isset($_POST['id']) ? (int)$_POST['id'] : 0; if ($id <= 0 && isset($_GET['id'])) { $id = (int)$_GET['id']; } try { if ($id > 0) { $st = $dbh->prepare('SELECT ProfileImage FROM tblmedicalcard WHERE ID = ?'); $st->execute([$id]); $row = $st->fetch(PDO::FETCH_ASSOC); $del = $dbh->prepare('DELETE FROM tblmedicalcard WHERE ID = ?'); $del->execute([$id]); if (!empty($row['ProfileImage'])) { $file = __DIR__ . '/../uploads/' . $row['ProfileImage']; if (is_file($file)) { @unlink($file); } } } header('Location: medicalcard-list.php'); exit; } catch (Throwable $e) { http_response_code(500); echo 'Delete failed: ' . htmlspecialchars($e->getMessage()); exit; }