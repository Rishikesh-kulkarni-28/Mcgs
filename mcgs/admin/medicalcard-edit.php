<?php require_once __DIR__.'/../includes/dbconnection.php'; require_once __DIR__.'/../includes/functions.php'; require_once __DIR__.'/header.php'; $id = (int)($_GET['id'] ?? 0); $st = $dbh->prepare('SELECT * FROM tblmedicalcard WHERE ID=?'); $st->execute([$id]); $r = $st->fetch(); if (!$r) { echo '<div class="alert alert-danger">Not found</div>'; require 'footer.php'; exit; } $msg=''; if ($_SERVER['REQUEST_METHOD']==='POST') { $name = post('FullName'); $phone = post('ContactNumber'); $email = post('Email'); $bg = post('BloodGroup'); $age = (int)post('Age'); $gender = post('Gender'); $address = post('Address'); $cond = post('MedicalCond'); $issued = post('IssuedDate'); $valid = post('ValidDate'); $imageName = $r['ProfileImage']; if (!empty($_FILES['ProfileImage']['name'])) { [$ok,$res] = validImageUpload($_FILES['ProfileImage']); if ($ok) { $imageName = $res; move_uploaded_file($_FILES['ProfileImage']['tmp_name'], __DIR__."/../uploads/".$imageName); } else { $msg=$res; } } if (!$msg) { $u = $dbh->prepare('UPDATE tblmedicalcard SET FullName=?,ProfileImage=?,ContactNumber=?,Email=?,BloodGroup=?,Age=?,Gender=?,Address=?,MedicalCond=?,IssuedDate=?,ValidDate=? WHERE ID=?'); $u->execute([$name,$imageName,$phone,$email,$bg,$age,$gender,$address,$cond,$issued,$valid,$id]); $msg='Updated successfully.'; $st->execute([$id]); $r = $st->fetch(); } } ?> <h3>Edit Medical Card (Ref #<?php echo htmlspecialchars($r['RefNumber']); ?>)</h3> <?php if($msg): ?><div class="alert alert-info"><?php echo htmlspecialchars($msg); ?></div><?php endif; ?> <form method="post" enctype="multipart/form-data" class="row g-3"> <div class="col-md-6"><label class="form-label">Full Name</label><input name="FullName" class="form-control" value="<?php echo htmlspecialchars($r['FullName']); ?>" required></div> <div class="col-md-6"><label class="form-label">Profile Image</label><input type="file" name="ProfileImage" class="form-control"></div> <div class="col-md-4"><label class="form-label">Contact Number</label><input name="ContactNumber" class="form-control" value="<?php echo htmlspecialchars($r['ContactNumber']); ?>"></div> <div class="col-md-4"><label class="form-label">Email</label><input name="Email" type="email" class="form-control" value="<?php echo htmlspecialchars($r['Email']); ?>"></div> <div class="col-md-4"><label class="form-label">Blood Group</label><input name="BloodGroup" class="form-control" value="<?php echo htmlspecialchars($r['BloodGroup']); ?>"></div> <div class="col-md-3"><label class="form-label">Age</label><input name="Age" type="number" class="form-control" value="<?php echo htmlspecialchars($r['Age']); ?>"></div> <div class="col-md-3"><label class="form-label">Gender</label> <select name="Gender" class="form-select"> <?php foreach(['Male','Female','Other'] as $g): ?> <option <?php echo ($r['Gender']===$g?'selected':''); ?>><?php echo $g; ?></option> <?php endforeach; ?> </select> </div> <div class="col-md-3"><label class="form-label">Issued Date</label><input name="IssuedDate" class="form-control" value="<?php echo htmlspecialchars($r['IssuedDate']); ?>"></div> <div class="col-md-3"><label class="form-label">Valid Date</label><input name="ValidDate" class="form-control" value="<?php echo htmlspecialchars($r['ValidDate']); ?>"></div> <div class="col-12"><label class="form-label">Address</label><textarea name="Address" class="form-control"><?php echo htmlspecialchars($r['Address']); ?></textarea></div> <div class="col-12"><label class="form-label">Medical Conditions</label><textarea name="MedicalCond" class="form-control"><?php echo htmlspecialchars($r['MedicalCond']); ?></textarea></div> <div class="col-12"><button class="btn btn-primary">Save</button> <a class="btn btn-secondary" href="medicalcard-list.php">Back</a></div> </form> <?php require_once __DIR__.'/footer.php'; ?>