<?php require_once __DIR__.'/../includes/dbconnection.php'; session_start(); if (empty($_SESSION['admin_id'])) { http_response_code(403); exit; } $from = $_GET['from'] ?? ''; $to = $_GET['to'] ?? ''; if (!$from || !$to) { http_response_code(400); exit; } $st = $dbh->prepare('SELECT RefNumber,FullName,ContactNumber,Email,CreationDate FROM tblmedicalcard WHERE DATE(CreationDate) BETWEEN ? AND ? ORDER BY CreationDate DESC'); $st->execute([$from,$to]); header('Content-Type: text/csv; charset=utf-8'); header('Content-Disposition: attachment; filename="medical_cards_'.$from.'_to_'.$to.'.csv"'); $fp = fopen('php://output', 'w'); fputcsv($fp, ['RefNumber','FullName','ContactNumber','Email','CreationDate']); while ($row = $st->fetch(PDO::FETCH_ASSOC)) { fputcsv($fp, $row); } fclose($fp); admin/search.php <?php require_once __DIR__.'/../includes/dbconnection.php'; require_once __DIR__.'/header.php'; $q = $_GET['q'] ?? ''; $r = null; if ($q!=='') { $st = $dbh->prepare('SELECT * FROM tblmedicalcard WHERE RefNumber=? OR ContactNumber=? LIMIT 1'); $st->execute([$q,$q]); $r = $st->fetch(); } ?> <h3>Search Medical Card</h3> <form class="row g-2 mb-3"> <div class="col-auto"><input class="form-control" name="q" placeholder="RefNumber or Mobile" value="<?php echo htmlspecialchars($q); ?>"></div> <div class="col-auto"><button class="btn btn-primary">Search</button></div> </form> <?php if ($r): ?> <div class="card card-body"> <h5><?php echo htmlspecialchars($r['FullName']); ?> (#<?php echo htmlspecialchars($r['RefNumber']); ?>)</h5> <p>Phone: <?php echo htmlspecialchars($r['ContactNumber']); ?> | Email: <?php echo htmlspecialchars($r['Email']); ?></p> <a class="btn btn-secondary" href="medicalcard-view.php?id=<?php echo $r['ID']; ?>">View</a> </div> <?php elseif($q!==''): ?> <div class="alert alert-warning">No record found.</div> <?php endif; ?> <?php require_once __DIR__.'/footer.php'; ?>